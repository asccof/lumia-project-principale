{% extends "base.html" %}
{% block title %}Messagerie — Tighri{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="h4 mb-3">Messagerie</h1>

  {% set threads = threads if threads is defined and threads else [] %}
  {% if threads %}
    <div class="list-group">
      {% for th in threads %}
        <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-start"
           href="/pro/messages/thread/{{ th.patient_id if th.patient_id is defined else th.id }}">
          <div class="me-auto">
            <div class="fw-semibold">
              {{ th.patient_name if th.patient_name is defined else 'Patient' }}
              {% if th.unread and th.unread>0 %}<span class="badge bg-primary ms-2">{{ th.unread }}</span>{% endif %}
            </div>
            <div class="small text-muted text-truncate" style="max-width: 560px;">
              {{ th.last_excerpt if th.last_excerpt is defined else th.last_message }}
            </div>
          </div>
          <small class="text-muted">{{ th.last_at if th.last_at is defined else '' }}</small>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">Aucune conversation pour l’instant.</div>
  {% endif %}
</div>
{% endblock %}
