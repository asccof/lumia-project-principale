{% extends "base.html" %}
{% block title %}Profil — {{ professional.name|e }}{% endblock %}

{% block extra_css %}
<style>
  :root{
    --primary:#8B5CF6; --primary-dark:#6D28D9;
    --ink:#2d1a47; --muted:#4B3869; --bg:#f7f5fa;
  }
  .page{max-width:1000px;margin:0 auto;padding:1rem 1rem 2.5rem}
  .back a{color:var(--primary);text-decoration:none}
  .back a:hover{text-decoration:underline}

  .prof-header{display:flex;gap:1.25rem;align-items:center;margin:1rem 0}
  .prof-avatar{width:112px;height:112px;border-radius:50%;overflow:hidden;background:#eee;flex:0 0 112px}
  .prof-avatar img{width:100%;height:100%;object-fit:cover;display:block}

  .badge{display:inline-block;margin:.25rem .4rem .25rem 0;padding:.25rem .6rem;border-radius:999px;background:#f4f0ff;color:#6D28D9;font-weight:700;font-size:.85rem}

  .section{background:#fff;border-radius:14px;box-shadow:0 2px 8px rgba(139,92,246,0.08);padding:1.25rem;margin:1rem 0}
  .section h2{margin:0 0 .5rem;color:#6D28D9}

  .cta{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.75rem}
  .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.65rem 1.1rem;border-radius:999px;border:2px solid transparent;cursor:pointer;font-weight:700;text-decoration:none}
  .btn-primary{background:var(--primary);color:#fff}
  .btn-primary:hover{background:var(--primary-dark)}
  .btn-ghost{background:#fff;border-color:#eee;color:#6D28D9}
  .btn-ghost:hover{border-color:#d8cfff}

  @media (max-width:720px){
    .prof-header{align-items:flex-start}
  }
</style>
{% endblock %}

{% block content %}
<div class="page">
  <div class="back">
    <a href="{{ url_for('index') }}">&larr; Retour</a>
  </div>

  <div class="prof-header">
    <div class="prof-avatar">
      <img
        src="{{ url_for('profile_photo', professional_id=professional.id) }}"
        alt="Photo de {{ professional.name|e }}"
        loading="lazy" width="112" height="112"
        onerror="this.onerror=null;this.src='https://placehold.co/224x224?text=Photo';">
    </div>
    <div>
      <h1 style="margin:.2rem 0 0">{{ professional.name }}</h1>
      <div style="color:#6D28D9;font-weight:600">{{ professional.specialty or 'Professionnel' }}</div>
      {% if professional.location %}<span class="badge" title="Ville">{{ professional.location }}</span>{% endif %}
      {% if professional.status %}<span class="badge" title="Statut">{{ professional.status }}</span>{% endif %}

      <div class="cta">
        <a class="btn btn-primary" href="{{ url_for('book_appointment', professional_id=professional.id) }}">Prendre rendez-vous</a>
        {% if professional.phone %}<a class="btn btn-ghost" href="tel:{{ professional.phone|replace(' ','') }}">Appeler</a>{% endif %}
      </div>
    </div>
  </div>

  <div class="section">
    <h2>À propos</h2>
    <p style="margin:0;line-height:1.7">{{ professional.description or '—' }}</p>
  </div>

  <div class="section">
    <h2>Informations</h2>
    <ul style="margin:0;padding-left:1rem;line-height:1.8">
      <li>Tarif : {{ (professional.consultation_fee or 0)|int }} MAD</li>
      <li>Expérience : {{ professional.experience_years or 0 }} an(s)</li>
      <li>Types de consultation : {{ (professional.consultation_types or 'cabinet').replace(',', ', ') }}</li>
      {% if professional.address %}<li>Adresse : {{ professional.address }}</li>{% endif %}
      {% if professional.latitude and professional.longitude %}
        <li>GPS : {{ professional.latitude }}, {{ professional.longitude }}</li>
      {% endif %}
    </ul>
  </div>

  <!-- Bloc Avis : affichage uniquement, pas de POST vers un endpoint inexistant -->
  <div id="reviews" class="section">
    <h2>Avis</h2>
    {% if reviews %}
      <div style="display:grid;gap:.75rem">
        {% for r in reviews %}
          <div style="border:1px solid #eee;border-radius:10px;padding:.75rem">
            <div style="font-weight:700">{{ r.author or 'Utilisateur' }}</div>
            <div style="opacity:.8">Note : {{ r.rating or '—' }}/5</div>
            <p style="margin:.4rem 0 0">{{ r.text or '' }}</p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="margin:.5rem 0 0;opacity:.8">Pas encore d’avis.</p>
    {% endif %}

    {# 
      NOTE: l’ancien template postait vers `url_for('add_review')` qui n’existe pas côté serveur,
      ce qui provoquait un 500 dès l’affichage. Ici, on NE poste plus (affichage seul).
      Quand tu auras un endpoint pour créer des avis, on branchera un <form> dessus.
    #}
  </div>
</div>
{% endblock %}
