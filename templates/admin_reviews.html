<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin — Avis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Avis des professionnels</h1>
    <div>
      <a class="btn btn-outline-secondary btn-sm {% if status=='pending' %}active{% endif %}" href="?status=pending">En attente</a>
      <a class="btn btn-outline-secondary btn-sm {% if status=='approved' %}active{% endif %}" href="?status=approved">Validés</a>
      <a class="btn btn-outline-secondary btn-sm {% if status=='all' %}active{% endif %}" href="?status=all">Tous</a>
      <a class="btn btn-primary btn-sm" href="{{ url_for('admin.admin_dashboard') }}">Dashboard</a>
    </div>
  </div>

  <div class="card">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Pro</th>
            <th>Utilisateur</th>
            <th>Note</th>
            <th>Commentaire</th>
            <th>Date</th>
            <th>État</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for r in reviews %}
          <tr id="row-{{ r.id }}">
            <td>{{ r.id }}</td>
            <td>{{ r.professional.name if r.professional else '—' }}</td>
            <td>{{ r.user.username if r.user else '—' }}</td>
            <td>{{ r.rating }}/5</td>
            <td style="max-width:420px">{{ r.comment }}</td>
            <td>{{ r.created_at.strftime('%d/%m/%Y %H:%M') if r.created_at else '' }}</td>
            <td>
              {% if r.approved %}
                <span class="badge bg-success">Validé</span>
              {% else %}
                <span class="badge bg-warning text-dark">En attente</span>
              {% endif %}
            </td>
            <td>
              {% if not r.approved %}
                <button class="btn btn-sm btn-success" onclick="approve({{ r.id }})">Valider</button>
                <button class="btn btn-sm btn-danger" onclick="reject({{ r.id }})">Supprimer</button>
              {% else %}
                <button class="btn btn-sm btn-outline-danger" onclick="reject({{ r.id }})">Supprimer</button>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<script>
async function approve(id){
  const r = await fetch(`/admin/reviews/${id}/approve`,{method:'POST'});
  if(r.ok){ document.querySelector(`#row-${id} td:nth-child(7)`).innerHTML='<span class="badge bg-success">Validé</span>'; }
}
async function reject(id){
  if(!confirm('Supprimer cet avis ?')) return;
  const r = await fetch(`/admin/reviews/${id}/reject`,{method:'POST'});
  if(r.ok){ document.querySelector(`#row-${id}`).remove(); }
}
</script>
</body>
</html>
