{% extends "admin_base.html" %}
{% block title %}Professionnels en attente - Administration Lumia{% endblock %}
{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 text-gray-800"><i class="fas fa-user-clock"></i> Professionnels en attente de validation</h1>
    <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Retour au tableau de bord</a>
  </div>

  {% if professionals %}
    <div class="row">
      {% for professional in professionals %}
      <div class="col-lg-6 col-xl-4 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
          <div class="card-body">
            <div class="d-flex align-items-center mb-2">
              <img src="{{ professional.image_url or 'https://via.placeholder.com/50x50/8B5CF6/FFFFFF?text=Pro' }}" alt="{{ professional.name }}" class="rounded-circle me-3" style="width:50px;height:50px;object-fit:cover;">
              <div><h6 class="fw-bold text-primary mb-0">{{ professional.name }}</h6><small class="text-muted">{{ professional.specialty }}</small></div>
            </div>
            <div class="mb-3">
              <p class="mb-1 text-muted"><i class="fas fa-map-marker-alt me-1"></i>{{ professional.location }}</p>
              <p class="mb-1 text-muted"><i class="fas fa-phone me-1"></i>{{ professional.phone }}</p>
              <p class="mb-1 text-muted"><i class="fas fa-clock me-1"></i>{{ professional.experience_years }} ans d'expérience</p>
              <p class="mb-1 text-muted"><i class="fas fa-money-bill me-1"></i>{{ professional.consultation_fee }} MAD</p>
            </div>
            <div class="mb-3">
              <small class="text-muted">Description:</small>
              <p class="mb-0">{{ professional.description[:100] }}{% if professional.description|length > 100 %}...{% endif %}</p>
            </div>
            <div class="mb-3">
              <small class="text-muted">Créé le:</small>
              <p class="mb-0">{{ professional.created_at.strftime('%d/%m/%Y à %H:%M') }}</p>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-success btn-sm" onclick="validateProfessional({{ professional.id }})"><i class="fas fa-check"></i> Valider</button>
              <button class="btn btn-danger btn-sm" onclick="rejectProfessional({{ professional.id }})"><i class="fas fa-times"></i> Rejeter</button>
              <a class="btn btn-info btn-sm" href="{{ url_for('admin.view_professional', professional_id=professional.id) }}"><i class="fas fa-eye"></i> Détails</a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-5">
      <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
      <h4 class="text-success">Aucun professionnel en attente</h4>
      <p class="text-muted">Tous les professionnels ont été traités.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
{% block extra_js %}
<script>
  function postJSON(url){ return fetch(url,{method:'POST',headers:{'Content-Type':'application/json'}}).then(async r=>{const ct=r.headers.get('content-type')||'';const p=ct.includes('application/json')?await r.json():{success:false,message:await r.text()};if(!r.ok) throw new Error(p.message||`HTTP ${r.status}`);return p;}); }
  function validateProfessional(id){
    if(!confirm('Valider ce professionnel ?')) return;
    postJSON("{{ url_for('admin.validate_professional', professional_id=0) }}".replace('0',id))
      .then(d=>{ if(d.success){ alert('Professionnel validé !'); location.reload(); } else { alert('Erreur: '+(d.message||'')); }})
      .catch(e=>{ console.error(e); alert('Erreur lors de la validation: '+e.message);});
  }
  function rejectProfessional(id){
    if(!confirm('Rejeter ce professionnel ?')) return;
    postJSON("{{ url_for('admin.reject_professional', professional_id=0) }}".replace('0',id))
      .then(d=>{ if(d.success){ alert('Professionnel rejeté'); location.reload(); } else { alert('Erreur: '+(d.message||'')); }})
      .catch(e=>{ console.error(e); alert('Erreur lors du rejet: '+e.message);});
  }
</script>
{% endblock %}
